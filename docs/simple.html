<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>simple demo - Gifsicle in browser (wasm)</title>
</head>

<body class="">
    <img src="1.gif" alt="">
    <br>
    👇
    <br>
    <img id="img" src="" alt="">



</body>
<script>
    (async function () {

        function gifsicleWorker(post = {}, workerUrl = '') {
            return new Promise((res, rej) => {
                let worker = new Worker(workerUrl);
                worker.postMessage(post);
                worker.onmessage = function (e) {
                    if (!e.data) {
                        worker.terminate();
                        rej(e)
                        return
                    }
                    worker.terminate();
                    res(e.data)
                };
                worker.onerror = function (e) {
                    worker.terminate();
                    rej(e)
                };
            })
        }

        let command = ['-O2', '--lossy=30','--rotate-90']
        let buffer = await fetch('./1.gif').then(file => file.arrayBuffer())
        gifsicleWorker({ buffer, command },
            //  All files are packed in gifsicleWorkerAllInPack.min.js
            // '../dist/gifsicleWorkerAllInPack.min.js'
            // or 
            // gifsicle.min.js、gifsicle.wasm and gifsicleWorker.min.js must be in the same directory
            '../dist/gifsicleWorker.min.js'
        ).then(blob => {
            // success
            console.log(blob)
            document.querySelector('#img').src = URL.createObjectURL(blob)
            // blob return -> Blob size: 736843 type: "image/gif"
        }).catch(e => {
            // error
            console.error(e);
        })

    })()

</script>

</html>